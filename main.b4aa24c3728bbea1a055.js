!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([,function(t,e,n){"use strict";n.r(e);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,t),this.x=e,this.y=n};function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u=function(t){for(var e=document.createElement(t),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.forEach((function(t){e.classList.add(t)})),e},d=function(t){var e=document.createElement("button");e.innerText=t;for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.forEach((function(t){e.classList.add(t)})),e},f=function(t,e){for(var n=-1;n<=1;n+=1)for(var r=-1;r<=1;r+=1)if(t.x+r>-1&&t.x+r<e.length&&t.y+n>-1&&t.y+n<e[0].length&&Math.abs(n)!==Math.abs(r)&&0===e[t.y+n][t.x+r])return new a(t.x+r,t.y+n);return!1},v=function(t){var e=Math.round(t/1e3),n=Math.floor(e/60),r=Math.floor(n/60);return(r>0?"".concat(r,":"):"")+(n%60>9?"".concat(n%60,":"):"0".concat(n%60,":"))+(e%60>9?"".concat(e%60):"0".concat(e%60))},h=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},y=function(t,e){if(h(t),0===e.length)t.classList.add("empty");else{for(var n=0;n<e.length&&n<10;n+=1){var r=u("li");r.innerText="".concat(n+1,"-е место: ").concat(e[n].bestScore," ходов за время: ").concat(v(e[n].bestTime),"."),t.appendChild(r)}t.classList.remove("empty")}},p=function(){for(var t=[],e=0;e<10;e+=1)if(localStorage.getItem("gemPuzzleBestScore".concat(e))){var n=parseInt(localStorage.getItem("gemPuzzleBestScore".concat(e)),10),r=parseInt(localStorage.getItem("gemPuzzleBestTime".concat(e)),10);t.push({bestScore:n,bestTime:r})}return t},m=function(t,e){Array.from(t.children).forEach((function(t){t.classList.remove(e)}))},b=function(t,e){var n=t.flat();if(0===n.pop()){var r=c(n).sort((function(t,e){return t-e}));n.join("")===r.join("")&&e()}},g=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=1,i=0;i<t;i+=1){for(var s=[],c=0;c<t;c+=1)s.push(r),r+=1;n.push(s)}n[t-1][t-1]=0;var l=new a(t-1,t-1);if(e)for(var u=0;u<100*Math.pow(t,2);u+=1){var d=Math.floor(4*Math.random()),f=o({},l);switch(d){case 0:f.x-=1;break;case 1:f.x+=1;break;case 2:f.y-=1;break;default:f.y+=1}if(f.x>=0&&f.x<t&&f.y>=0&&f.y<t){var v=n[f.x][f.y];n[f.x][f.y]=0,n[l.x][l.y]=v,l=f}}return n};function x(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var L,T,O=u("div","controlls"),E=[["Размешать и начать","start"],["Пауза / Продолжить","pause"],["Результаты","result"],["Сохранить","save"],["Вернуться к сохраненной игре","loadSave"]].map((function(t){var e=d.apply(void 0,x(t));return O.appendChild(e),e})),j=(T=5,function(t){if(Array.isArray(t))return t}(L=E)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}(L,T)||S(L,T)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),M=j[0],C=j[1],z=j[2],P=j[3],k=j[4],I=u("div","score"),A=u("span","progress"),_=u("span","time");A.innerText="0",_.innerText="00:00",I.appendChild(A),I.appendChild(_);var H=u("div","field"),D=u("div","sizes");[3,4,5,6,7,8].forEach((function(t){var e=d("".concat(t,"x").concat(t));e.setAttribute("data-size",t),4===t&&e.classList.add("selected"),D.appendChild(e)}));var B=u("div","lock","on"),N=u("div","message"),J=u("p","text");J.innerHTML='\nУра! Вы решили головоломку за <span id="js-time"></span> и <span id="js-count"></span> ходов!\n';var V=d("OK");N.appendChild(J),N.appendChild(V);var X=u("div","best"),Y=u("div","best__place"),U=u("h4","best__title"),K=u("ul","best__list");U.innerText="Рекорды";var W=d("OK");function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Y.appendChild(U),Y.appendChild(K),Y.appendChild(W),X.appendChild(Y),document.body.appendChild(O),document.body.appendChild(I),document.body.appendChild(H),document.body.appendChild(D),document.body.appendChild(B),document.body.appendChild(N),document.body.appendChild(X);var F=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$(this,t),this.startTime=Date.now(),this.current=0,this.startValue=n,this.total=n,this.HTMLElement=e,this.HTMLElement.innerText=v(0),this.display.bind(this),this.isStarted=!1}var e,n,r;return e=t,(n=[{key:"getCurrent",value:function(){return this.current=Date.now()-this.startTime,this.current}},{key:"getTotal",value:function(){return this.isStarted&&(this.total=this.startValue+this.getCurrent()),this.total}},{key:"display",value:function(){this.HTMLElement.innerText=v(this.getTotal())}},{key:"start",value:function(){var t=this;this.startTime=Date.now(),this.startValue=this.total,this.isUsed=!0,this.isStarted||(this.interval=setInterval((function(){return t.display()}),1e3)),this.isStarted=!0}},{key:"stop",value:function(){this.isStarted&&(clearInterval(this.interval),this.getTotal(),this.isStarted=!1)}},{key:"restart",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;clearInterval(this.interval),this.HTMLElement.innerText=v(t),this.startTime=Date.now(),this.total=t,this.current=0,this.startValue=t,this.isStarted=!1,this.start()}},{key:"clear",value:function(){clearInterval(this.interval),this.isStarted=!1,this.HTMLElement.innerText=v(0)}}])&&q(e.prototype,n),r&&q(e,r),t}(),G=new F(_);function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var R=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.HTMLElement=e,this.value=0}var e,n,r;return e=t,(n=[{key:"set",value:function(t){this.value=t,this.HTMLElement.innerText=t}},{key:"next",value:function(){this.set(this.value+1)}},{key:"clear",value:function(){this.set(0)}}])&&Q(e.prototype,n),r&&Q(e,r),t}(),Z=new R(A),tt=function(){var t=document.getElementById("js-count"),e=document.getElementById("js-time"),n=p();G.stop();var r=Z.value,a=G.getTotal();t.innerText=r,e.innerText=v(a),N.classList.add("visible"),function(t){for(var e=0;e<t.length&&e<10;e+=1)localStorage.setItem("gemPuzzleBestScore".concat(e),"".concat(t[e].bestScore)),localStorage.setItem("gemPuzzleBestTime".concat(e),"".concat(t[e].bestTime))}(n=function(t,e,n){var r=[],a=!1;if(0===t.length)r.push({bestScore:e,bestTime:n});else for(var i=0;i<t.length;i+=1)!a&&(t[i].bestScore>e||t[i].bestTime>n)&&(r.push({bestScore:e,bestTime:n}),a=!0),r.push(t[i]);return r}(n,r,a)),y(K,n),V.addEventListener("click",(function(){Z.clear(),G.restart(),N.classList.remove("visible"),B.classList.add("on"),C.classList.remove("active"),P.classList.remove("active")}),{once:!0}),K.classList.remove("empty")},et=function(t,e,n,r){var i=r,o=n,s=u("div","item");return s.innerText="".concat(t),s.style.height="".concat(e,"%"),s.style.width="".concat(e,"%"),s.style.top="".concat(e*o.y,"%"),s.style.left="".concat(e*o.x,"%"),s.addEventListener("mousedown",(function(n){var r=f(o,i),c=new a(n.clientX,n.clientY),l=!1;if(r){var u=new a(o.x*e,o.y*e),d=r.x<o.x?[r.x,o.x]:[o.x,r.x],v=r.y<o.y?[r.y,o.y]:[o.y,r.y],h=function(t){var n=new a(t.clientX-c.x,t.clientY-c.y);Math.abs(n.x)+Math.abs(n.y)>5&&(l=!0);var i=e*o.x+e*n.x/s.offsetWidth,f=e*o.y+e*n.y/s.offsetHeight;r.x-o.x!=0?i>=d[0]*e&&i<=d[1]*e&&(s.style.left="".concat(i,"%"),u.x=i):f>=v[0]*e&&f<=v[1]*e&&(s.style.top="".concat(f,"%"),u.y=f)};s.classList.remove("smooth"),window.addEventListener("mousemove",h),window.addEventListener("mouseup",(function(){window.removeEventListener("mousemove",h),s.classList.add("smooth"),(d[0]!==d[1]&&Math.abs(r.x*e-u.x)<Math.abs(o.x*e-u.x)||v[0]!==v[1]&&Math.abs(r.y*e-u.y)<Math.abs(o.y*e-u.y)||!l)&&(i[o.y][o.x]=0,i[(o=r).y][o.x]=t,Z.next(),b(i,tt)),s.style.top="".concat(e*o.y,"%"),s.style.left="".concat(e*o.x,"%")}),{once:!0})}})),s.addEventListener("touchstart",(function(n){var r=f(o,i),c=new a(n.clientX,n.clientY),l=!1;if(r){var u=new a(o.x*e,o.y*e),d=r.x<o.x?[r.x,o.x]:[o.x,r.x],v=r.y<o.y?[r.y,o.y]:[o.y,r.y],h=function(){(d[0]!==d[1]&&Math.abs(r.x*e-u.x)<Math.abs(o.x*e-u.x)||v[0]!==v[1]&&Math.abs(r.y*e-u.y)<Math.abs(o.y*e-u.y)||!l)&&(i[o.y][o.x]=0,i[(o=r).y][o.x]=t,Z.next(),b(i,tt)),s.style.top="".concat(e*o.y,"%"),s.style.left="".concat(e*o.x,"%")},y=function(t){var n=new a(t.clientX-c.x,t.clientY-c.y);Math.abs(n.x)+Math.abs(n.y)>5&&(l=!0);var i=e*o.x+e*n.x/s.offsetWidth,f=e*o.y+e*n.y/s.offsetHeight;r.x-o.x!=0?i>=d[0]*e&&i<=d[1]*e&&(s.style.left="".concat(i,"%"),u.x=i):f>=v[0]*e&&f<=v[1]*e&&(s.style.top="".concat(f,"%"),u.y=f)};s.classList.remove("smooth"),window.addEventListener("touchmove",y),window.addEventListener("touchend",(function(){window.removeEventListener("touchmove",y),s.classList.add("smooth"),h()}),{once:!0}),window.addEventListener("touchcancel",(function(){window.removeEventListener("touchmove",y),s.classList.add("smooth"),h()}),{once:!0})}})),s},nt=function(t){for(var e=100/t.length,n=0;n<t.length;n+=1)for(var r=0;r<t.length;r+=1){var i=t[n][r],o=new a(r,n);0!==i&&H.appendChild(et(i,e,o,t))}},rt=4,at=g(rt,!1),it=p();y(K,it),h(H),nt(at),D.addEventListener("click",(function(t){if(t.target.parentNode===D){var e=parseInt(t.target.dataset.size,10);rt!==e&&(G.clear(),Z.clear(),B.classList.add("on"),C.classList.remove("active"),P.classList.remove("active"),at=g(e,!1),h(H),nt(at),m(D,"selected"),t.target.classList.add("selected"),rt=e)}})),M.addEventListener("click",(function(){at=g(rt,!0),h(H),nt(at),G.restart(),Z.clear(),B.classList.remove("on"),C.classList.remove("active"),P.classList.remove("active")})),P.addEventListener("click",(function(){localStorage.gemPuzzleSave=JSON.stringify(at),localStorage.gemPuzzleTime=JSON.stringify(G.getTotal()),localStorage.gemPuzzleScore=JSON.stringify(Z.value)})),k.addEventListener("click",(function(){localStorage.gemPuzzleSave&&(at=JSON.parse(localStorage.gemPuzzleSave),rt!==at.length&&(rt=at.length,m(D,"selected"),D.querySelector('[data-size="'.concat(rt,'"]')).classList.add("selected")),h(H),nt(at),G.restart(JSON.parse(localStorage.gemPuzzleTime)),Z.set(JSON.parse(localStorage.gemPuzzleScore)),B.classList.remove("on"))})),C.addEventListener("click",(function(){G.isStarted?(G.stop(),B.classList.add("on"),C.classList.add("active"),P.classList.add("active")):(G.start(),B.classList.remove("on"),C.classList.remove("active"),P.classList.remove("active"))})),z.addEventListener("click",(function(){var t=!1;G.isStarted&&(G.stop(),t=!0),X.classList.add("visible"),W.addEventListener("click",(function(){X.classList.remove("visible"),t&&G.start()}),{once:!0})}))}]);